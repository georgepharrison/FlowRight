<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Class MustAsyncContextAwareRule&lt;T&gt; | FlowRight - Result Pattern Library for .NET </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Class MustAsyncContextAwareRule&lt;T&gt; | FlowRight - Result Pattern Library for .NET ">
      
      <meta name="description" content="An asynchronous context-aware validation rule that applies a custom condition function with access to validation context. This rule enables complex validation scenarios that require async operations and access to root objects, services, or custom data.">
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ManagedReference">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="FlowRight">
            FlowRight
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="FlowRight.Validation.Rules.MustAsyncContextAwareRule`1">



  <h1 id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1" data-uid="FlowRight.Validation.Rules.MustAsyncContextAwareRule`1" class="text-break">
Class MustAsyncContextAwareRule&lt;T&gt;  
  </h1>

  <div class="facts text-secondary">
    <dl><dt>Namespace</dt><dd><a class="xref" href="FlowRight.html">FlowRight</a>.<a class="xref" href="FlowRight.Validation.html">Validation</a>.<a class="xref" href="FlowRight.Validation.Rules.html">Rules</a></dd></dl>
  <dl><dt>Assembly</dt><dd>FlowRight.Validation.dll</dd></dl>
  </div>

  <div class="markdown summary"><p>An asynchronous context-aware validation rule that applies a custom condition function with access to validation context.
This rule enables complex validation scenarios that require async operations and access to root objects, services, or custom data.</p>
</div>
  <div class="markdown conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public sealed class MustAsyncContextAwareRule&lt;T&gt; : IAsyncContextAwareRule&lt;T&gt;</code></pre>
  </div>



  <h4 class="section">Type Parameters</h4>
  <dl class="parameters">
    <dt><code>T</code></dt>
    <dd><p>The type of value to validate.</p>
</dd>
  </dl>

  <dl class="typelist inheritance">
    <dt>Inheritance</dt>
    <dd>
      <div><span class="xref">object</span></div>
      <div><span class="xref">MustAsyncContextAwareRule&lt;T&gt;</span></div>
    </dd>
  </dl>

  <dl class="typelist implements">
    <dt>Implements</dt>
    <dd>
      <div><a class="xref" href="FlowRight.Validation.Rules.IAsyncContextAwareRule-1.html">IAsyncContextAwareRule</a>&lt;T&gt;</div>
    </dd>
  </dl>





  <h2 id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1_examples">Examples</h2>
  <pre><code class="lang-csharp">// Async database validation with context
var rule = new MustAsyncContextAwareRule&lt;string&gt;(
    async (email, context) =&gt; 
    {
        IUserRepository? repository = context.GetService&lt;IUserRepository&gt;();
        if (repository != null)
        {
            return !await repository.EmailExistsAsync(email);
        }
        return false;
    },
    "Email address is already in use");

// Async web service validation with cross-property check
var serviceRule = new MustAsyncContextAwareRule&lt;string&gt;(
    async (value, context) =&gt; 
    {
        User? user = context.GetRootObject&lt;User&gt;();
        IValidationService? service = context.GetService&lt;IValidationService&gt;();

        if (user != null &amp;&amp; service != null)
        {
            return await service.ValidateWithUserContextAsync(value, user.Id);
        }
        return false;
    },
    "Value failed external validation service");

// Async validation with custom data and retry logic
var retryRule = new MustAsyncContextAwareRule&lt;string&gt;(
    async (value, context) =&gt; 
    {
        int maxRetries = context.GetCustomData&lt;int&gt;("MaxRetries");
        IExternalService? service = context.GetService&lt;IExternalService&gt;();

        for (int i = 0; i &lt;= maxRetries; i++)
        {
            try
            {
                return await service?.ValidateAsync(value) ?? false;
            }
            catch when (i &lt; maxRetries)
            {
                await Task.Delay(TimeSpan.FromMilliseconds(100 * (i + 1)));
            }
        }
        return false;
    },
    "External validation failed after retries");</code></pre>


  <h2 id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1_remarks">Remarks</h2>
  <div class="markdown level0 remarks"><p>
This rule extends validation capabilities to support asynchronous operations while providing access to the validation context.
It enables validation logic that depends on:
<ul><li>Asynchronous database queries or web service calls</li><li>Other properties of the root object being validated</li><li>External services accessed through dependency injection</li><li>Custom data shared between validation rules</li><li>Parent-child relationships in hierarchical validation</li><li>Previously executed validation rules and their results</li></ul>

<p>
The condition function should return true if the validation passes, or false if it fails.
When the condition returns false, the specified error message will be used as the validation error.
</p>
</div>


  <h2 class="section" id="constructors">Constructors
</h2>


  <a id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1__ctor_" data-uid="FlowRight.Validation.Rules.MustAsyncContextAwareRule`1.#ctor*"></a>

  <h3 id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1__ctor_System_Func__0_FlowRight_Validation_Context_IValidationContext_System_Threading_Tasks_Task_System_Boolean___System_String_" data-uid="FlowRight.Validation.Rules.MustAsyncContextAwareRule`1.#ctor(System.Func{`0,FlowRight.Validation.Context.IValidationContext,System.Threading.Tasks.Task{System.Boolean}},System.String)">
  MustAsyncContextAwareRule(Func&lt;T, IValidationContext, Task&lt;bool&gt;&gt;, string)
  
  </h3>

  <div class="markdown level1 summary"><p>An asynchronous context-aware validation rule that applies a custom condition function with access to validation context.
This rule enables complex validation scenarios that require async operations and access to root objects, services, or custom data.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public MustAsyncContextAwareRule(Func&lt;T, IValidationContext, Task&lt;bool&gt;&gt; condition, string errorMessage)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>condition</code> <span class="xref">Func</span>&lt;T, <a class="xref" href="FlowRight.Validation.Context.IValidationContext.html">IValidationContext</a>, <span class="xref">Task</span>&lt;<span class="xref">bool</span>&gt;&gt;</dt>
    <dd><p>The async condition function that receives both the value and validation context.</p>
</dd>
    <dt><code>errorMessage</code> <span class="xref">string</span></dt>
    <dd><p>The error message to return when validation fails.</p>
</dd>
  </dl>







  <h4 class="section" id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1__ctor_System_Func__0_FlowRight_Validation_Context_IValidationContext_System_Threading_Tasks_Task_System_Boolean___System_String__examples">Examples</h4>
  <pre><code class="lang-csharp">// Async database validation with context
var rule = new MustAsyncContextAwareRule&lt;string&gt;(
    async (email, context) =&gt; 
    {
        IUserRepository? repository = context.GetService&lt;IUserRepository&gt;();
        if (repository != null)
        {
            return !await repository.EmailExistsAsync(email);
        }
        return false;
    },
    "Email address is already in use");

// Async web service validation with cross-property check
var serviceRule = new MustAsyncContextAwareRule&lt;string&gt;(
    async (value, context) =&gt; 
    {
        User? user = context.GetRootObject&lt;User&gt;();
        IValidationService? service = context.GetService&lt;IValidationService&gt;();

        if (user != null &amp;&amp; service != null)
        {
            return await service.ValidateWithUserContextAsync(value, user.Id);
        }
        return false;
    },
    "Value failed external validation service");

// Async validation with custom data and retry logic
var retryRule = new MustAsyncContextAwareRule&lt;string&gt;(
    async (value, context) =&gt; 
    {
        int maxRetries = context.GetCustomData&lt;int&gt;("MaxRetries");
        IExternalService? service = context.GetService&lt;IExternalService&gt;();

        for (int i = 0; i &lt;= maxRetries; i++)
        {
            try
            {
                return await service?.ValidateAsync(value) ?? false;
            }
            catch when (i &lt; maxRetries)
            {
                await Task.Delay(TimeSpan.FromMilliseconds(100 * (i + 1)));
            }
        }
        return false;
    },
    "External validation failed after retries");</code></pre>


  <h4 class="section" id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1__ctor_System_Func__0_FlowRight_Validation_Context_IValidationContext_System_Threading_Tasks_Task_System_Boolean___System_String__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This rule extends validation capabilities to support asynchronous operations while providing access to the validation context.
It enables validation logic that depends on:
<ul><li>Asynchronous database queries or web service calls</li><li>Other properties of the root object being validated</li><li>External services accessed through dependency injection</li><li>Custom data shared between validation rules</li><li>Parent-child relationships in hierarchical validation</li><li>Previously executed validation rules and their results</li></ul>

<p>
The condition function should return true if the validation passes, or false if it fails.
When the condition returns false, the specified error message will be used as the validation error.
</p>
</div>




  <h2 class="section" id="methods">Methods
</h2>


  <a id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1_ValidateAsync_" data-uid="FlowRight.Validation.Rules.MustAsyncContextAwareRule`1.ValidateAsync*"></a>

  <h3 id="FlowRight_Validation_Rules_MustAsyncContextAwareRule_1_ValidateAsync__0_System_String_FlowRight_Validation_Context_IValidationContext_" data-uid="FlowRight.Validation.Rules.MustAsyncContextAwareRule`1.ValidateAsync(`0,System.String,FlowRight.Validation.Context.IValidationContext)">
  ValidateAsync(T, string, IValidationContext)
  
  </h3>

  <div class="markdown level1 summary"><p>Asynchronously validates the value using the custom condition function with access to validation context.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Task&lt;string?&gt; ValidateAsync(T value, string displayName, IValidationContext context)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>value</code> <span class="xref">T</span></dt>
    <dd><p>The value to validate.</p>
</dd>
    <dt><code>displayName</code> <span class="xref">string</span></dt>
    <dd><p>The display name for the property being validated.</p>
</dd>
    <dt><code>context</code> <a class="xref" href="FlowRight.Validation.Context.IValidationContext.html">IValidationContext</a></dt>
    <dd><p>The validation context providing access to root object, services, and custom data.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><span class="xref">Task</span>&lt;<span class="xref">string</span>&gt;</dt>
    <dd><p>A task that represents the asynchronous validation operation. The task result contains
an error message if validation fails; otherwise, null indicating validation passed.</p>
</dd>
  </dl>












</article>

        <div class="contribution d-print-none">
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          FlowRight - Explicit error handling without exceptions
        </div>
      </div>
    </footer>
  </body>
</html>
